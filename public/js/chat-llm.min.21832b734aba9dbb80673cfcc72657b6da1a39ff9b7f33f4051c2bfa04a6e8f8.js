document.addEventListener("DOMContentLoaded",function(){const d=document.getElementById("chat-llm-container"),f=document.getElementById("chat-llm-toggle"),o=document.getElementById("chat-llm-box"),u=document.getElementById("chat-llm-close"),n=document.getElementById("chat-llm-messages"),e=document.getElementById("chat-llm-input"),i=document.getElementById("chat-llm-send"),r=document.querySelector('.chat-llm-social-buttons a[href*="whatsapp"]'),c=document.querySelector('.chat-llm-social-buttons a[href*="telegram"]');if(!d)return;let s=[{role:"system",content:"You are a helpful assistant that answers questions about the current article."},{role:"assistant",content:"Hi! I can answer questions about this article. What would you like to know?"}];const h=document.querySelector(".singleBlog__content")?.innerText||"",m=document.querySelector(".breadCrumb__title")?.innerText||"",t={title:m,url:window.location.href,tags:Array.from(document.querySelectorAll(".tag-category")).map(e=>e.innerText),publishDate:document.querySelector(".fa-calendar")?.nextSibling?.textContent.trim()||"",readingTime:document.querySelector(".fa-clock-o")?.nextSibling?.textContent.trim()||""};s[0].content=`You are a helpful assistant that answers questions about the current article. 
  Here is the article content: 
  Title: ${t.title}
  URL: ${t.url}
  Tags: ${t.tags.join(", ")}
  Published: ${t.publishDate}
  Reading Time: ${t.readingTime}
  
  Content:
  ${h}
  
  Answer questions based on this content. If the answer is not in the content, say so politely.`,f.addEventListener("click",function(){o.style.display=o.style.display==="none"||o.style.display===""?"flex":"none"}),u.addEventListener("click",function(){o.style.display="none"}),r&&r.addEventListener("click",function(e){e.preventDefault(),console.log("WhatsApp button clicked");const n=`Hi! I'm interested in your article: "${t.title}" (${t.url})`,s=encodeURIComponent(n),o=this.getAttribute("href").split("?")[0],i=`${o}?text=${s}`;window.open(i,"_blank")}),c&&c.addEventListener("click",function(e){e.preventDefault(),console.log("Telegram button clicked");const n=`Hi! I'm interested in your article: "${t.title}" (${t.url})`,s=encodeURIComponent(n),o=this.getAttribute("href").split("?")[0],i=`${o}?text=${s}`;window.open(i,"_blank")}),e.addEventListener("keydown",function(t){t.key==="Enter"&&!t.shiftKey&&(t.preventDefault(),l()),setTimeout(()=>{e.style.height="auto",e.style.height=Math.min(e.scrollHeight,100)+"px"},0)}),i.addEventListener("click",l);function l(){const o=e.value.trim();if(!o)return;a("user",o),s.push({role:"user",content:o}),e.value="",e.style.height="auto";const t=document.createElement("div");t.className="chat-llm-loading",t.innerHTML="<span></span><span></span><span></span>",n.appendChild(t),n.scrollTop=n.scrollHeight,e.disabled=!0,i.disabled=!0,p(s).then(o=>{n.removeChild(t),a("assistant",o),s.push({role:"assistant",content:o}),e.disabled=!1,i.disabled=!1,e.focus()}).catch(s=>{n.removeChild(t),a("assistant","Sorry, there was an error processing your request. Please try again."),e.disabled=!1,i.disabled=!1,e.focus(),console.error("Error calling LLM API:",s)})}function a(e,t){const s=document.createElement("div");s.className=`chat-llm-message chat-llm-message-${e}`;const o=document.createElement("div");o.className="chat-llm-message-content",o.textContent=t,s.appendChild(o),n.appendChild(s),n.scrollTop=n.scrollHeight}async function p(e){try{const n=window.arliaiApiKey||"ARLIAI_API_KEY",t=await fetch("https://api.arliai.com/v1/chat/completions",{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${n}`},body:JSON.stringify({model:"Mistral-Nemo-12B-Instruct-2407",messages:e,repetition_penalty:1.1,temperature:.7,top_p:.9,top_k:40,max_tokens:1024,stream:!1})});if(!t.ok)throw new Error(`API request failed with status ${t.status}`);const s=await t.json();return s.choices[0].message.content}catch(s){console.error("Error calling LLM API:",s);const n=e.filter(e=>e.role==="user").pop().content.toLowerCase();return n.includes("hello")||n.includes("hi")?"Hello! How can I help you with information about this article?":n.includes("thank")?"You're welcome! Feel free to ask if you have any other questions.":n.includes("what is this article about")?`This article is about "${t.title}". It covers topics related to ${t.tags.join(", ")}. Is there something specific you'd like to know about it?`:"I'm having trouble connecting to the API right now. Please try again later, or ask a different question."}}})