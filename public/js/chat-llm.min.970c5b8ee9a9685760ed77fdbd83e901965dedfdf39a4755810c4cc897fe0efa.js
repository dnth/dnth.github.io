document.addEventListener("DOMContentLoaded",function(){const u=document.getElementById("chat-llm-container"),h=document.getElementById("chat-llm-toggle"),s=document.getElementById("chat-llm-box"),c=document.getElementById("chat-llm-close"),t=document.getElementById("chat-llm-messages"),e=document.getElementById("chat-llm-input"),o=document.getElementById("chat-llm-send");if(!u)return;let i=[{role:"system",content:"You are a helpful assistant that answers questions about the current article."},{role:"assistant",content:"Hi! I can answer questions about this article. What would you like to know?"}];const d=document.querySelector(".singleBlog__content")?.innerText||"",l=document.querySelector(".breadCrumb__title")?.innerText||"",n={title:l,url:window.location.href,tags:Array.from(document.querySelectorAll(".tag-category")).map(e=>e.innerText),publishDate:document.querySelector(".fa-calendar")?.nextSibling?.textContent.trim()||"",readingTime:document.querySelector(".fa-clock-o")?.nextSibling?.textContent.trim()||""};i[0].content=`You are a helpful assistant that answers questions about the current article. 
  Here is the article content: 
  Title: ${n.title}
  URL: ${n.url}
  Tags: ${n.tags.join(", ")}
  Published: ${n.publishDate}
  Reading Time: ${n.readingTime}
  
  Content:
  ${d}
  
  Answer questions based on this content. If the answer is not in the content, say so politely.`,h.addEventListener("click",function(){s.style.display=s.style.display==="none"||s.style.display===""?"flex":"none"}),c.addEventListener("click",function(){s.style.display="none"}),e.addEventListener("keydown",function(t){t.key==="Enter"&&!t.shiftKey&&(t.preventDefault(),r()),setTimeout(()=>{e.style.height="auto",e.style.height=Math.min(e.scrollHeight,100)+"px"},0)}),o.addEventListener("click",r);function r(){const s=e.value.trim();if(!s)return;a("user",s),i.push({role:"user",content:s}),e.value="",e.style.height="auto";const n=document.createElement("div");n.className="chat-llm-loading",n.innerHTML="<span></span><span></span><span></span>",t.appendChild(n),t.scrollTop=t.scrollHeight,e.disabled=!0,o.disabled=!0,m(i).then(s=>{t.removeChild(n),a("assistant",s),i.push({role:"assistant",content:s}),e.disabled=!1,o.disabled=!1,e.focus()}).catch(s=>{t.removeChild(n),a("assistant","Sorry, there was an error processing your request. Please try again."),e.disabled=!1,o.disabled=!1,e.focus(),console.error("Error calling LLM API:",s)})}function a(e,n){const s=document.createElement("div");s.className=`chat-llm-message chat-llm-message-${e}`;const o=document.createElement("div");o.className="chat-llm-message-content",o.textContent=n,s.appendChild(o),t.appendChild(s),t.scrollTop=t.scrollHeight}async function m(e){try{const n=window.arliaiApiKey||"ARLIAI_API_KEY",t=await fetch("https://api.arliai.com/v1/chat/completions",{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${n}`},body:JSON.stringify({model:"Mistral-Nemo-12B-Instruct-2407",messages:e,repetition_penalty:1.1,temperature:.7,top_p:.9,top_k:40,max_tokens:1024,stream:!1})});if(!t.ok)throw new Error(`API request failed with status ${t.status}`);const s=await t.json();return s.choices[0].message.content}catch(s){console.error("Error calling LLM API:",s);const t=e.filter(e=>e.role==="user").pop().content.toLowerCase();return t.includes("hello")||t.includes("hi")?"Hello! How can I help you with information about this article?":t.includes("thank")?"You're welcome! Feel free to ask if you have any other questions.":t.includes("what is this article about")?`This article is about "${n.title}". It covers topics related to ${n.tags.join(", ")}. Is there something specific you'd like to know about it?`:"I'm having trouble connecting to the API right now. Please try again later, or ask a different question."}}})