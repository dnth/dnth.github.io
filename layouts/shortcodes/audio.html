<style>
    .custom-audio-player {
        width: 100%;
        max-width: 600px;
        margin: 20px auto;
        background: #ffffff;
        border-radius: 10px;
        padding: 20px 20px 10px;
        box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
    }
    .audio-info {
        margin-bottom: 15px;
    }
    .audio-title {
        font-size: 1em;
        font-weight: bold;
        color: #333;
        margin-bottom: 5px;
    }
    .audio-author {
        font-size: 0.9em;
        color: #666;
    }
    .custom-audio-player audio {
        width: 100%;
        height: 40px;
        outline: none;
        border-radius: 0 0 5px 5px;
        margin-top: -5px;
    }
    .custom-audio-player audio::-webkit-media-controls-panel {
        background-color: #e0e0e0;
    }
    .custom-audio-player audio::-webkit-media-controls-play-button,
    .custom-audio-player audio::-webkit-media-controls-mute-button {
        background-color: #8492ff;
        border-radius: 50%;
    }
    .custom-audio-player audio::-webkit-media-controls-current-time-display,
    .custom-audio-player audio::-webkit-media-controls-time-remaining-display {
        color: #333;
    }
    .visualizer-container {
        width: 100%;
        height: 150px;
        background-color: #1a1a1a;
        border-radius: 5px 5px 0 0;
        overflow: hidden;
    }
    .visualizer {
        width: 100%;
        height: 60px;
        background-color: #2c3e50;
        margin-top: 10px;
        border-radius: 5px;
    }
</style>

<div class="custom-audio-player">
    <div class="audio-header">
        <div class="audio-info">
            <div class="audio-title">{{ .Get "title" | default "Audio Track" }}</div>
            <div class="audio-author">{{ .Get "author" | default "Unknown Artist" }}</div>
        </div>
    </div>
    <div class="visualizer-container">
        <canvas id="visualizer"></canvas>
    </div>
    <audio id="audio" controls preload="metadata">
        <source src="{{ .Get "src" }}">
        Your browser does not support the audio element.
    </audio>
</div>

<script>
    document.addEventListener('DOMContentLoaded', function() {
        const audioElement = document.getElementById('audio');
        const canvas = document.getElementById('visualizer');
        const ctx = canvas.getContext('2d');

        const audioContext = new (window.AudioContext || window.webkitAudioContext)();
        const analyser = audioContext.createAnalyser();
        const source = audioContext.createMediaElementSource(audioElement);
        source.connect(analyser);
        analyser.connect(audioContext.destination);

        analyser.fftSize = 256;
        const bufferLength = analyser.frequencyBinCount;
        const dataArray = new Uint8Array(bufferLength);

        function resizeCanvas() {
            canvas.width = canvas.offsetWidth;
            canvas.height = canvas.offsetHeight;
        }

        resizeCanvas();
        window.addEventListener('resize', resizeCanvas);

        let previousDataArray = new Uint8Array(bufferLength);

        function draw() {
            requestAnimationFrame(draw);

            analyser.getByteFrequencyData(dataArray);

            ctx.fillStyle = 'rgba(26, 26, 26, 0.2)';
            ctx.fillRect(0, 0, canvas.width, canvas.height);

            // Use the full frequency data
            const barWidth = (canvas.width / bufferLength) * 3.5; // Leave some space between bars
            const barSpacing = (canvas.width / bufferLength) * 1.3;

            for (let i = 0; i < bufferLength; i++) {
                const value = (dataArray[i] + previousDataArray[i]) / 2;
                const percent = value / 255;
                const height = canvas.height * percent;
                const offset = canvas.height - height;

                // Create gradient for each bar
                const gradient = ctx.createLinearGradient(0, offset, 0, canvas.height);
                gradient.addColorStop(0, 'rgba(102, 119, 249, 0.8)');
                gradient.addColorStop(0.5, 'rgba(255, 0, 128, 0.8)');
                gradient.addColorStop(1, 'rgba(102, 119, 249, 0.8)');

                ctx.fillStyle = gradient;

                // Draw the bar
                ctx.fillRect(i * (barWidth + barSpacing), offset, barWidth, height);
            }

            previousDataArray.set(dataArray);
        }

        audioElement.addEventListener('play', function() {
            audioContext.resume().then(() => draw());
        });
    });
</script>